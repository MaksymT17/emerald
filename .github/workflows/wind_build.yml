name: Build Windows

on:
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install pkg-config
      run: |
        choco install pkgconfiglite

    - name: Set up vcpkg
      run: |
        git clone https://github.com/microsoft/vcpkg.git
        cd vcpkg
        git checkout 2023.05
        .\bootstrap-vcpkg.bat

    - name: Install GTK+ 3.0
      run: |
        .\vcpkg\vcpkg integrate install
        .\vcpkg\vcpkg install gtk3:x64-windows

    - name: Checkout emerald repo
      uses: actions/checkout@v3
      with:
        repository: MaksymT17/emerald
        ref: ${{ github.head_ref }}
        path: emerald

    - name: Build artifacts with CMake
      run: |
        cd emerald &&
        echo "removing existing build folder..."
        mkdir build &&
        echo "preparing new build with cmake..." &&
        cd build/ &&
        cmake .. &&
        cmake --build . &&
        echo "Build complete!"
      shell: bash